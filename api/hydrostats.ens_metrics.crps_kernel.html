
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>crps_kernel &#8212; hydrostats 0.75 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ens_crps" href="hydrostats.ens_metrics.ens_crps.html" />
    <link rel="prev" title="crps_hersbach" href="hydrostats.ens_metrics.crps_hersbach.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="hydrostats.ens_metrics.ens_crps.html" title="ens_crps"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hydrostats.ens_metrics.crps_hersbach.html" title="crps_hersbach"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hydrostats 0.75 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../ens_metrics.html" accesskey="U">Metrics of Ensemble Forecast Skill (hydrostats.ens_metrics)</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Preprocessing.html">Preprocessing (hydrostats.data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Visualization.html">Visualization (hydrostats.visual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Metrics.html">Metrics of Hydrological Skill (hydrostats.metrics)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ens_metrics.html">Metrics of Ensemble Forecast Skill (hydrostats.ens_metrics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis.html">Analysis (hydrostats.analyze)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref_table.html">Quick Reference Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_types.html">List of Plot File Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timezones.html">List of Timezones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matplotlib_linestyles.html">Matplotlib Linestyles Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../change_log.html">Release Notes</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="hydrostats.ens_metrics.crps_hersbach.html"
                        title="previous chapter">crps_hersbach</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="hydrostats.ens_metrics.ens_crps.html"
                        title="next chapter">ens_crps</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/hydrostats.ens_metrics.crps_kernel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="crps-kernel">
<h1>crps_kernel<a class="headerlink" href="#crps-kernel" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="hydrostats.ens_metrics.crps_kernel">
<code class="descclassname">hydrostats.ens_metrics.</code><code class="descname">crps_kernel</code><span class="sig-paren">(</span><em>obs</em>, <em>fcst_ens</em>, <em>remove_neg=False</em>, <em>remove_zero=False</em><span class="sig-paren">)</span><a class="headerlink" href="#hydrostats.ens_metrics.crps_kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the kernel representation of the continuous ranked probability score (CRPS).</p>
<p>Calculates the kernel representation of the continuous ranked probability score (CRPS) as per
equation 3 in Leutbecher et al. (2018) and the adjusted (or fair) crps as per equation 6 in the
same paper. Note that it was Gneiting and Raftery (2007) who show the kernel representation as
calculated here is equivalent to the standard definition based on the integral
over the squared error of the cumulative distribution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>obs: 1D ndarray</strong></dt>
<dd><p class="first last">array of observations for each start date.</p>
</dd>
<dt><strong>fcst_ens: 2D ndarray</strong></dt>
<dd><p class="first last">Array of ensemble forecast of dimension n x M, where n = number of start dates and
M = number of ensemble members.</p>
</dd>
<dt><strong>remove_neg: bool</strong></dt>
<dd><p class="first last">If True, when a negative value is found at the i-th position in the observed OR ensemble
array, the i-th value of the observed AND ensemble array are removed before the
computation.</p>
</dd>
<dt><strong>remove_zero: bool</strong></dt>
<dd><p class="first last">If true, when a zero value is found at the i-th position in the observed OR ensemble
array, the i-th value of the observed AND ensemble array are removed before the
computation.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>dict</strong></dt>
<dd><dl class="first last docutils">
<dt>Dictionary of outputs includes:</dt>
<dd><ul class="first last simple">
<li>[“crps”] 1D ndarray with crps values of length n.</li>
<li>[“crpsAdjusted”] 1D ndarray with adjusted crps values of length n.</li>
<li>[“crpsMean”] Arithmetic mean of crps values as a float.</li>
<li>[“crpsAdjustedMean”] Arithmetic mean of adjusted crps values as a float.</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p><strong>NaN treatment:</strong> If any start date in obs is NaN, then the corresponding row in fcst
(for all ensemble members) will also be deleted.</p>
<p class="rubric">References</p>
<ul class="simple">
<li>Gneiting, T. and Raftery, A. E. (2007) Strictly proper scoring rules,
prediction and estimation, J. Amer. Stat. Asoc., 102, 359-378.</li>
<li>Leutbecher, M. (2018) Ensemble size: How suboptimal is less than infinity?,
Q. J. R. Meteorol., Accepted.</li>
</ul>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hydrostats.ens_metrics</span> <span class="k">as</span> <span class="nn">em</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">3849590438</span><span class="p">)</span>
</pre></div>
</div>
<p>Creating an observed 1D array and an ensemble 2D array with all random numbers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ens_array_random</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">52</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obs_array_random</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Creating an observed 1D array and an ensemble 2D array with noise.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">52</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">observed_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ensemble_array_noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span> <span class="mi">52</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">observed_array</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">noise</span>
</pre></div>
</div>
<p>Computing the Hersbach CRPS values between the ensemble mean and the observed data with the
random data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_rand</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">crps_kernel</span><span class="p">(</span><span class="n">obs_array_random</span><span class="p">,</span> <span class="n">ens_array_random</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">crps_dictionary_rand</span><span class="p">[</span><span class="s1">&#39;crps&#39;</span><span class="p">])</span>
<span class="go">[ 7.73360237  9.59248626 34.46719655 30.10271075  7.451665   16.07882352</span>
<span class="go"> 14.59543529  8.55181637 15.4833089   8.32422363 16.55108154 19.20821296</span>
<span class="go">  8.39452279 12.59949378 27.82543302]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">crps_dictionary_rand</span><span class="p">[</span><span class="s1">&#39;crpsAdjusted&#39;</span><span class="p">])</span>
<span class="go">[ 7.43000827  9.29100065 34.14067524 29.76359191  7.14776152 15.75147589</span>
<span class="go"> 14.25192856  8.23647876 15.19419171  8.05998301 16.26113448 18.90686679</span>
<span class="go">  8.09725139 12.24021268 27.45673444]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_rand</span><span class="p">[</span><span class="s1">&#39;crpsMean&#39;</span><span class="p">]</span>
<span class="go">15.797334183277723</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_rand</span><span class="p">[</span><span class="s1">&#39;crpsAdjustedMean&#39;</span><span class="p">]</span>
<span class="go">15.481953018707593</span>
</pre></div>
</div>
<p>Computing the Hersbach CRPS values between the ensemble mean and the observed data with noise
in the ensemble data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_noise</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">crps_kernel</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">observed_array</span><span class="p">,</span> <span class="n">fcst_ens</span><span class="o">=</span><span class="n">ensemble_array_noise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">crps_dictionary_noise</span><span class="p">[</span><span class="s1">&#39;crps&#39;</span><span class="p">])</span>
<span class="go">[0.26921152 0.21388687 0.24927151 0.26047667 0.30234843 0.1996493</span>
<span class="go"> 0.2779844  0.29478927 0.275383   0.25682693 0.21485236 0.22824711</span>
<span class="go"> 0.2813889  0.21264652 0.18141063]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">crps_dictionary_noise</span><span class="p">[</span><span class="s1">&#39;crpsAdjusted&#39;</span><span class="p">])</span>
<span class="go">[0.25850726 0.20482797 0.23908004 0.25032814 0.28996894 0.18961905</span>
<span class="go"> 0.2670867  0.2821429  0.2634554  0.24573507 0.20457832 0.21730326</span>
<span class="go"> 0.26951946 0.2034818  0.17198615]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_noise</span><span class="p">[</span><span class="s1">&#39;crpsMean&#39;</span><span class="p">]</span>
<span class="go">0.2478915604121471</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crps_dictionary_noise</span><span class="p">[</span><span class="s1">&#39;crpsAdjustedMean&#39;</span><span class="p">]</span>
<span class="go">0.23717469718824744</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="hydrostats.ens_metrics.ens_crps.html" title="ens_crps"
             >next</a> |</li>
        <li class="right" >
          <a href="hydrostats.ens_metrics.crps_hersbach.html" title="crps_hersbach"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hydrostats 0.75 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../ens_metrics.html" >Metrics of Ensemble Forecast Skill (hydrostats.ens_metrics)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Wade Roberts.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>