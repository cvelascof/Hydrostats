
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>time_lag &#8212; hydrostats 0.75 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quick Reference Table" href="../ref_table.html" />
    <link rel="prev" title="make_table" href="hydrostats.analyze.make_table.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../ref_table.html" title="Quick Reference Table"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hydrostats.analyze.make_table.html" title="make_table"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hydrostats 0.75 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Analysis.html" accesskey="U">Analysis (hydrostats.analyze)</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Preprocessing.html">Preprocessing (hydrostats.data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Visualization.html">Visualization (hydrostats.visual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Metrics.html">Metrics of Hydrological Skill (hydrostats.metrics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ens_metrics.html">Metrics of Ensemble Forecast Skill (hydrostats.ens_metrics)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Analysis.html">Analysis (hydrostats.analyze)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref_table.html">Quick Reference Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_types.html">List of Plot File Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timezones.html">List of Timezones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matplotlib_linestyles.html">Matplotlib Linestyles Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../change_log.html">Release Notes</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="hydrostats.analyze.make_table.html"
                        title="previous chapter">make_table</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ref_table.html"
                        title="next chapter">Quick Reference Table</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/hydrostats.analyze.time_lag.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="time-lag">
<h1>time_lag<a class="headerlink" href="#time-lag" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="hydrostats.analyze.time_lag">
<code class="descclassname">hydrostats.analyze.</code><code class="descname">time_lag</code><span class="sig-paren">(</span><em>merged_dataframe</em>, <em>metrics</em>, <em>interp_freq='6H'</em>, <em>interp_type='pchip'</em>, <em>shift_range=(-30</em>, <em>30)</em>, <em>mase_m=1</em>, <em>dmod_j=1</em>, <em>nse_mod_j=1</em>, <em>h6_mhe_k=1</em>, <em>h6_ahe_k=1</em>, <em>h6_rmshe_k=1</em>, <em>d1_p_obs_bar_p=None</em>, <em>lm_x_obs_bar_p=None</em>, <em>replace_nan=None</em>, <em>replace_inf=None</em>, <em>remove_neg=False</em>, <em>remove_zero=False</em>, <em>plot=False</em>, <em>plot_title='Metric Values as Different Lags'</em>, <em>ylabel='Metric Value'</em>, <em>xlabel='Number of Lags'</em>, <em>save_fig=None</em>, <em>figsize=(10</em>, <em>6)</em>, <em>station=None</em><span class="sig-paren">)</span><a class="headerlink" href="#hydrostats.analyze.time_lag" title="Permalink to this definition">¶</a></dt>
<dd><p>Check metric values between simulated and observed data at different time lags.</p>
<p>Runs a time lag analysis to check for potential timing errors in the simulated data. Can also create a
plot using matplotlib of the metric values at different shifts.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>merged_dataframe: DataFrame</strong></dt>
<dd><p class="first last">A pandas dataframe that has two columns of predicted data (Col 0) and observed data (Col 1)
with a datetime index.</p>
</dd>
<dt><strong>metrics: list of str</strong></dt>
<dd><p class="first last">Metric abbreviations that the user would like to use in their lag analysis.</p>
</dd>
<dt><strong>interp_freq: str, optional</strong></dt>
<dd><p class="first last">Frequency of the interpolation for both the simulated and observed time series.</p>
</dd>
<dt><strong>interp_type: str, optional</strong></dt>
<dd><p class="first last">Type of interpolation. Options are ‘linear’, ‘pchip’, or ‘cubic’.</p>
</dd>
<dt><strong>shift_range: tuple of 2 floats, optional</strong></dt>
<dd><p class="first last">If given, specifies the range of the lag shifts. For example, if (-10, 10) was given, the
function would shift the simulated array for all of the range between -10 and 10.</p>
</dd>
<dt><strong>mase_m: int, Optional</strong></dt>
<dd><p class="first last">Parameter for the mean absolute scaled error (MASE) metric.</p>
</dd>
<dt><strong>dmod_j: int or float, optional</strong></dt>
<dd><p class="first last">Parameter for the modified index of agreement (dmod) metric.</p>
</dd>
<dt><strong>nse_mod_j: int or float, optional</strong></dt>
<dd><p class="first last">Parameter for the modified Nash-Sutcliffe (nse_mod) metric.</p>
</dd>
<dt><strong>h6_mhe_k: int or float, optional</strong></dt>
<dd><p class="first last">Parameter for the H6 (MHE) metric.</p>
</dd>
<dt><strong>h6_ahe_k: int or float, optional</strong></dt>
<dd><p class="first last">Parameter for the H6 (AHE) metric</p>
</dd>
<dt><strong>h6_rmshe_k: int or float, optional</strong></dt>
<dd><p class="first last">Parameter for the H6 (RMSHE) metric</p>
</dd>
<dt><strong>d1_p_obs_bar_p: float, optional</strong></dt>
<dd><p class="first last">Parameter fot the Legate McCabe Index of Agreement (d1_p).</p>
</dd>
<dt><strong>lm_x_obs_bar_p: float, optional</strong></dt>
<dd><p class="first last">Parameter for the Lagate McCabe Efficiency Index (lm_index).</p>
</dd>
<dt><strong>replace_nan: float, optional</strong></dt>
<dd><p class="first last">If given, indicates which value to replace NaN values with in the two arrays. If None, when
a NaN value is found at the i-th position in the observed OR simulated array, the i-th value
of the observed and simulated array are removed before the computation.</p>
</dd>
<dt><strong>replace_inf: float, optional</strong></dt>
<dd><p class="first last">If given, indicates which value to replace Inf values with in the two arrays. If None, when
an inf value is found at the i-th position in the observed OR simulated array, the i-th
value of the observed and simulated array are removed before the computation.</p>
</dd>
<dt><strong>remove_neg: boolean, optional</strong></dt>
<dd><p class="first last">If True, when a negative value is found at the i-th position in the observed OR simulated
array, the i-th value of the observed AND simulated array are removed before the
computation.</p>
</dd>
<dt><strong>remove_zero: boolean, optional</strong></dt>
<dd><p class="first last">If true, when a zero value is found at the i-th position in the observed OR simulated
array, the i-th value of the observed AND simulated array are removed before the
computation.</p>
</dd>
<dt><strong>plot: bool, optional</strong></dt>
<dd><p class="first last">If True, a plot will be created that visualizes the different error metrics at the
different time lags.</p>
</dd>
<dt><strong>plot_title: str, optional</strong></dt>
<dd><p class="first last">If the plot parameter is true, this parameter will set the title of the plot.</p>
</dd>
<dt><strong>ylabel: str, optional</strong></dt>
<dd><p class="first last">If the plot parameter is true, this parameter will set the y axis label of the plot.</p>
</dd>
<dt><strong>xlabel: str, optional</strong></dt>
<dd><p class="first last">if the plot parameter is true, this parameter will set the x axis label of the plot.</p>
</dd>
<dt><strong>save_fig: str, optional</strong></dt>
<dd><p class="first last">If given, will save the matplotlib plot to the specified directory with the specified file
name (e.g. /path/to/plot.png). A list of all available types of figures is given in
<a class="reference internal" href="../plot_types.html#plot-types"><span class="std std-ref">List of Plot File Types</span></a>.</p>
</dd>
<dt><strong>figsize: tuple of length 2</strong></dt>
<dd><p class="first last">Tuple that specifies the horizontal and vertical lengths of the plot, in inches.</p>
</dd>
<dt><strong>station: str</strong></dt>
<dd><p class="first last">The station of analysis. Includes the station in the table if given.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>Tuple of DataFrames</strong></dt>
<dd><p class="first last">The first DataFrame contains all of the metric values at different time lags, while the 
second dataframe contains the maximum and minimum metric values throughout the time lag, 
and the index of the maximum and minimum time lag values.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>If desired, users can export the tables to a CSV or Excel Workbook. This can be done using the built in methods
of pandas. A link to CSV method can be found at
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html">https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html</a> and a link to the Excel
method can be found at
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_excel.html">https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_excel.html</a></p>
<p class="rubric">Examples</p>
<p>Using data from the Streamflow prediction tool RAPID model and the ECMWF model, we can conpare
the two at different time lags</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hydrostats.analyze</span> <span class="k">as</span> <span class="nn">ha</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hydrostats.data</span> <span class="k">as</span> <span class="nn">hd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="mi">50</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Defining the URLs of the datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sfpt_url</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https://github.com/waderoberts123/Hydrostats/raw/master/Sample_data/sfpt_data/magdalena-calamar_interim_data.csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glofas_url</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https://github.com/waderoberts123/Hydrostats/raw/master/Sample_data/GLOFAS_Data/magdalena-calamar_ECMWF_data.csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Merging the data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">hd</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="n">sfpt_url</span><span class="p">,</span> <span class="n">glofas_url</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;SFPT&#39;</span><span class="p">,</span> <span class="s1">&#39;GLOFAS&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>There are two dataframes that are returned as part of the analysis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Running the lag analysis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time_lag_df</span><span class="p">,</span> <span class="n">summary_df</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="n">time_lag</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;KGE (2012)&#39;</span><span class="p">,</span> <span class="s1">&#39;NSE&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">summary_df</span>
<span class="go">                    Max  Max Lag Number          Min  Min Lag Number</span>
<span class="go">ME           174.740510           -28.0   174.740510           -24.0</span>
<span class="go">r2             0.891854            -2.0     0.646193           -30.0</span>
<span class="go">RMSE        3142.795474           -30.0  1754.455598            -2.0</span>
<span class="go">KGE (2012)     0.877116            -2.0     0.775328           -30.0</span>
<span class="go">NSE            0.856358            -2.0     0.539076           -30.0</span>
</pre></div>
</div>
<p>A plot can be created that visualizes the different metrics throughout the time lags. It can be
saved using the savefig parameter as well if desired.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="n">time_lag</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;KGE (2012)&#39;</span><span class="p">,</span> <span class="s1">&#39;dr&#39;</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/lag_plot1.png" src="../_images/lag_plot1.png" />
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../ref_table.html" title="Quick Reference Table"
             >next</a> |</li>
        <li class="right" >
          <a href="hydrostats.analyze.make_table.html" title="make_table"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hydrostats 0.75 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Analysis.html" >Analysis (hydrostats.analyze)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Wade Roberts.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>